{% extends 'base.html' %}
{% load static %}
{% block title %}Página Home{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
<link rel="stylesheet" href="https://uicdn.toast.com/calendar/latest/toastui-calendar.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://uicdn.toast.com/calendar/latest/toastui-calendar.min.js"></script>
<script type="module" defer src="{% static 'js/home.js' %}"></script>
{% endblock %}

{% block content %}
<div class="home-layout">

  <!-- Saludo -->
  <div class="bienvenida-home">
    <div class="bienvenida-usuario d-flex align-items-center gap-4">
      <img src="https://res.cloudinary.com/dzlcfql7y/image/upload/v1744240295/prodito_risa_hijnjl.png" alt="Mascota" class="monito-img">
      <div class="saludo-home">
        <h2 class="saludo-usuario">¡Hola, {{ request.user.first_name|default:"Usuario" }}!</h2>
        <p>¿Qué haremos hoy?</p>
      </div>
    </div>
    
    <div class="boton-nueva-tarea">
      <!-- Botón para abrir modal de nueva tarea -->
      <button id="btnAbrirModal" class="btn nueva-tarea-btn">Nueva Tarea</button>
    </div>
  </div>

  <!-- Modal creación de tarea -->
  <dialog id="modalCrearTarea" class="modal">
    <form method="dialog" id="formCrearTarea" class="modal-content form-group">
      <h2>Crear Nueva Tarea</h2>

      <label for="tituloInput">Título:</label><br>
      <input type="text" id="tituloInput" class="form-control" required><br><br>

      <label for="fechaInput">Fecha y Hora:</label><br>
      <input type="text" id="fechaInput" class="form-control" required><br><br>

      <label for="descripcionInput">Descripción:</label><br>
      <textarea id="descripcionInput" class="form-control" rows="3"></textarea><br><br>

      <menu>
        <button value="cancel" class="btn btn-outline-danger" type="button" id="btnCancelar">Cancelar</button>
        <button value="confirm" class="btn btn-primary" type="submit">Guardar</button>
      </menu>
    </form>
  </dialog>

  <!-- Área de contenido principal -->
  <div class="content-sections">

    <!-- Columna Izquierda -->
    <div class="left-column">
      
      <!-- Tareas -->
      <div class="card mb-4">
        <h5 class="fw-bold mb-3">Tareas de Hoy</h5>
        {% if tareas_hoy %}
          <ul class="list-group list-group-flush">
            {% for tarea in tareas_hoy %}
              <li class="list-group-item">
                <strong>{{ tarea.titulo }}</strong><br>
                {% if tarea.hora %}
                  <small>{{ tarea.hora }}</small><br>
                {% endif %}
                {% if tarea.etiquetas.all %}
                  <div class="mt-1">
                    {% for etiqueta in tarea.etiquetas.all %}
                      <span class="badge" style="background-color: {{ etiqueta.color }}">{{ etiqueta.nombre }}</span>
                    {% endfor %}
                  </div>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted">No tienes tareas registradas hoy.</p>
        {% endif %}
        <a href="{% url 'tareas' %}" class="btn ir-tareas-btn mt-3">Ir a Mis Tareas</a>
      </div>

      <!-- Metas -->
      <div class="card">
        <h5 class="fw-bold mb-3">Metas Activas</h5>
        {% if metas_activas %}
          <ul class="list-group list-group-flush">
            {% for meta in metas_activas %}
              <li class="list-group-item">
                <strong>{{ meta.titulo }}</strong><br>
                <small>Fecha límite: {{ meta.fecha_limite }}</small>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted">No tienes metas activas.</p>
        {% endif %}
        <a href="{% url 'metas' %}" class="btn ir-tareas-btn mt-3">Ir a Mis Metas</a>
      </div>

    </div>

    <!-- Columna Derecha (Calendario) -->
    <div class="calendar-column">
      <div class="calendar-card">
        <h3 class="titulo-calendario">Mi calendario</h3>
        <div class="calendar-controls mb-3">
          <button id="prevBtn">◀</button>
          <button id="todayBtn">Hoy</button>
          <button id="nextBtn">▶</button>
        </div>
        <div id="calendar"></div>
      </div>
    </div>

  </div>

</div>
{% endblock %}