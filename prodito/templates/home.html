{% extends 'base.html' %}
{% load static %}
{% block title %}Página Home{% endblock %}
{% block extra_css %}

<link rel="stylesheet" href="{% static 'css/home.css' %}">
<link rel="stylesheet" href="https://uicdn.toast.com/calendar/latest/toastui-calendar.min.css" />
<script src="https://uicdn.toast.com/calendar/latest/toastui-calendar.min.js"></script>
<script type="text/javascript" src="tui-date-picker.js"></script>
<script type="module" src="{% static 'js/home.js' %}"></script>

{% endblock %}

{% block header %}
<div class="header-wrapper d-flex align-items-center gap-2">
  <img width="45rem" src="https://res.cloudinary.com/dtnttrleq/image/upload/v1744407778/prodito_risa_hijnjl_ucgvci.png"
    alt="Monito pródito" class="monito-img">

  <div class="usuario-barra">
    {% if request.user.is_authenticated %}
    <span class="fw-bold saludo-usuario">Hola, {{ request.user.username|capfirst }}!</span>

    <a href="#" class="btn btn-success btn-sm boton-recompensa">Ver recompensas</a>

    <form method="POST" action="{% url 'cerrar_sesion' %}" style="display:inline;">
      {% csrf_token %}
      <button type="submit" class="btn btn-outline-danger btn-sm">Cerrar sesión</button>
    </form>
    {% if request.user.is_staff %}
    <a href="/admin/" class="btn btn-warning btn-sm">ADMIN</a>
  {% endif %}
    {% endif %}
  </div>
  {% endblock %}

  {% block content %}
  <div class="home-layout">

    <aside>
      <div class="sidebar-content">
        <h5 class="fw-bold mb-3">Tareas de Hoy</h5>
        {% if tareas_hoy %}
        <ul class="list-group mb-3">
          {% for tarea in tareas_hoy %}
          <li class="list-group-item">
            <strong>{{ tarea.titulo }}</strong><br>
            {% if tarea.hora %}<small>{{ tarea.hora }}</small><br>{% endif %}
            {% if tarea.etiquetas.all %}
            <div class="mt-1">
              {% for etiqueta in tarea.etiquetas.all %}
              <span class="badge" style="background-color: {{ etiqueta.color }}">{{ etiqueta.nombre }}</span>
              {% endfor %}
            </div>
            {% endif %}
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <p class="text-muted">No tienes tareas registradas hoy.</p>
        {% endif %}

        <a href="{% url 'tareas' %}" class="btn btn-primary w-100">Mis Tareas</a>
      </div>
    </aside>

    <main>
      <div class="calendar-controls">
        <button id="prevBtn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
            class="bi bi-chevron-left" viewBox="0 0 16 16">
            <path fill-rule="evenodd"
              d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0" />
          </svg></button>
        <button id="todayBtn">Hoy</button>
        <button id="nextBtn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
            class="bi bi-chevron-right" viewBox="0 0 16 16">
            <path fill-rule="evenodd"
              d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708" />
          </svg></button>
      </div>
      <div id="calendar" style="height: 800px"></div>
    </main>
  </div>

  {% endblock %}